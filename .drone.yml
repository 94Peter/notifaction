---
kind: pipeline
type: exec
name: default

platform:
  os: darwin
  arch: amd64

steps:
- name: check-golangci
  commands:
  - export PATH=$PATH:/opt/homebrew/bin
  - make check-golangci
- name: check-code-coverage
  commands:
  - export PATH=$PATH:/usr/local/go/bin/go
  - make check-coverage
- name: build-docker-image
  commands:
  - make docker IMAGE_TAG=test
- name: restart service
  commands:
  - docker compose -f .docker-compose/test.yaml down
  - docker compose -f .docker-compose/test.yaml up -d
  - docker image prune -f

trigger:
  branch:
  - main
  event:
  - push
...